---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.



```{r}
simulate_data_dep <- function(n, seed = NULL) {
  if (!is.null(seed)) set.seed(seed)
  
  # --- Simulate X ---
  # X consists of a categorical variable with 3 levels and a numerical variable (values 1,2,3)
  X_cat <- sample(1:3, n, replace = TRUE, prob = rep(1/3, 3))
  X_num <- sample(1:3, n, replace = TRUE, prob = rep(1/3, 3))
  
  # Compute a categorical effect based on the raw X_cat values:
  # Category 1: effect = 0, Category 2: effect = 0.5, Category 3: effect = -0.5
  cat_effect <- ifelse(X_cat == 1, 0, ifelse(X_cat == 2, 0.5, -0.5))
  
  # One-hot encode the categorical variable using two dummy columns
  # Here, X_cat1 and X_cat2 indicate categories 1 and 2; if both are 0, it implies category 3.
  X_cat_dummy <- data.frame(
    X_cat1 = as.integer(X_cat == 1),
    X_cat2 = as.integer(X_cat == 2)
  )
  
  # --- Define possible values for Delta and T ---
  delta_vals <- -4:4   # Delta takes values from -4 to 4 (9 categories)
  T_vals     <- 1:5    # T takes values from 1 to 5 (5 categories)
  
  # Pre-allocate vectors for Delta and T.
  Delta <- numeric(n)
  T <- numeric(n)
  
  # --- Sample Delta and T conditionally on X ---
  # For each observation, compute conditional probability weights that depend on X_num and cat_effect.
  for (i in 1:n) {
    # For Delta:
    weights_delta <- exp(delta_vals / 2 + 0.2 * X_num[i] + cat_effect[i])
    weights_delta <- weights_delta / sum(weights_delta)
    Delta[i] <- sample(delta_vals, 1, prob = weights_delta)
    
    # For T:
    weights_T <- exp(T_vals / 2 + 0.3 * X_num[i] + cat_effect[i])
    weights_T <- weights_T / sum(weights_T)
    T[i] <- sample(T_vals, 1, prob = weights_T)
  }
  
  # --- Compute the indicator variable ---
  Indicator <- as.integer(T <= Delta)
  
  # --- Combine into a data frame ---
  # Include the numerical variable and the one-hot encoded (two-column) categorical variable.
  df <- data.frame(
    Delta = Delta,
    T = T,
    Indicator = Indicator,
    X_num = X_num
  )
  df <- cbind(df, X_cat_dummy)
  
  return(df)
}

# Example usage:
data <- simulate_data_dep(100, seed = 42)
df <- subset(data, select = -T) #dataframe without T
print(data)
```

```{r}

```
